version: "3.9"

services:
  postgres:
    image: postgres:16
    container_name: jam-postgres
    environment:
      POSTGRES_DB: jamdb
      POSTGRES_USER: jamuser
      POSTGRES_PASSWORD: jampassword
    ports:
      - "5432:5432"
    volumes:
      - jam-postgres-data:/var/lib/postgresql/data

  backend:
    build:
      context: ./backend/jam-backend
    container_name: jam-backend
    environment:
      # БД
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/jamdb
      SPRING_DATASOURCE_USERNAME: jamuser
      SPRING_DATASOURCE_PASSWORD: jampassword
      # JWT и LLM (ключ лучше передавать через переменную окружения)
      SECURITY_JWT_SECRET: change_this_secret_in_real_env
      LLM_API_KEY: ${LLM_API_KEY:-replace_me_with_real_key}
    ports:
      - "9081:8080"
    depends_on:
      - postgres

volumes:
  jam-postgres-data:
